<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan-B-Check ‚Äì Wie resilient ist Ihre Energieversorgung?</title>
    <meta name="description" content="8 Fragen, 3 Minuten: Pr√ºfen Sie, wie gut Sie auf einen Energieengpass vorbereitet sind.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 640px;
            width: 100%;
            padding: 1.5rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 1.5rem 0 1rem;
        }
        .header h1 {
            font-size: 1.4rem;
            color: #f39c12;
            margin-bottom: 0.25rem;
        }
        .header p {
            font-size: 0.85rem;
            color: #888;
        }

        /* Progress */
        .progress-wrap {
            margin-bottom: 2rem;
        }
        .progress-bar {
            height: 4px;
            background: #1a1a2e;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #e67e22);
            border-radius: 2px;
            transition: width 0.4s ease;
            width: 0%;
        }
        .progress-label {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.4rem;
            text-align: right;
        }

        /* Question Card */
        .question-card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 2rem 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            opacity: 1;
            transform: translateX(0);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .question-card.slide-out {
            opacity: 0;
            transform: translateX(-30px);
        }
        .question-card.slide-in {
            opacity: 0;
            transform: translateX(30px);
        }

        .q-category {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #666;
            margin-bottom: 0.75rem;
        }
        .q-number {
            font-size: 0.8rem;
            color: #f39c12;
            margin-bottom: 0.5rem;
        }
        .q-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }
        .q-hint {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        /* Answer Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            margin-top: auto;
        }
        .option-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: #1a1a2e;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 0.9rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .option-btn:hover {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.08);
            color: #fff;
        }
        .option-btn.selected {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.15);
            color: #fff;
        }
        .option-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
            width: 2rem;
            text-align: center;
        }
        .option-label {
            font-weight: 500;
        }
        .option-desc {
            font-size: 0.75rem;
            color: #888;
            margin-top: 0.15rem;
        }
        .option-btn.selected .option-desc { color: #aaa; }

        /* Navigation */
        .nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
        }
        .btn-back {
            background: none;
            border: 1px solid #333;
            color: #888;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .btn-back:hover { border-color: #555; color: #ccc; }
        .btn-back:disabled { opacity: 0.3; cursor: default; }

        /* Intro screen */
        .intro {
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 1.5rem;
        }
        .intro-icon { font-size: 3.5rem; }
        .intro h2 {
            font-size: 1.5rem;
            color: #fff;
        }
        .intro p {
            color: #999;
            font-size: 0.9rem;
            line-height: 1.6;
            max-width: 420px;
            margin: 0 auto;
        }
        .btn-start {
            display: inline-block;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
            padding: 0.85rem 2.5rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 0.5rem;
        }
        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.3);
        }

        /* Result screen */
        .result { display: none; flex-direction: column; gap: 1.5rem; }
        .result.active { display: flex; }

        .score-ring {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            position: relative;
        }
        .score-ring svg {
            transform: rotate(-90deg);
            width: 180px;
            height: 180px;
        }
        .score-ring .bg {
            fill: none;
            stroke: #1a1a2e;
            stroke-width: 10;
        }
        .score-ring .fg {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            stroke-dasharray: 502;
            stroke-dashoffset: 502;
            transition: stroke-dashoffset 1.5s ease, stroke 0.5s ease;
        }
        .score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .score-value .num {
            font-size: 2.8rem;
            font-weight: 700;
            color: #fff;
            line-height: 1;
        }
        .score-value .of {
            font-size: 0.8rem;
            color: #666;
        }

        .score-label {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }

        .weakness-list {
            background: #111;
            border: 1px solid #222;
            border-radius: 10px;
            padding: 1.25rem;
        }
        .weakness-list h3 {
            font-size: 0.9rem;
            color: #f39c12;
            margin-bottom: 0.75rem;
        }
        .weakness-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #1a1a2e;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        .weakness-item:last-child { border-bottom: none; }
        .weakness-item .wi-icon { flex-shrink: 0; font-size: 1rem; }
        .weakness-item .wi-cat {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #666;
            margin-top: 0.2rem;
        }

        .result-cta {
            text-align: center;
            padding: 1rem 0;
        }
        .result-cta a {
            display: inline-block;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #fff;
            font-weight: 600;
            text-decoration: none;
            padding: 0.75rem 2rem;
            border-radius: 30px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .result-cta a:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.3);
        }
        .result-cta .sub {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .btn-restart {
            background: none;
            border: 1px solid #333;
            color: #888;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin: 0 auto;
            display: block;
            transition: all 0.2s;
        }
        .btn-restart:hover { border-color: #555; color: #ccc; }

        /* Footer link */
        .back-link {
            text-align: center;
            padding: 1.5rem 0;
            font-size: 0.8rem;
        }
        .back-link a {
            color: #666;
            text-decoration: none;
            transition: color 0.2s;
        }
        .back-link a:hover { color: #f39c12; }

        @media (max-width: 480px) {
            .container { padding: 1rem; }
            .question-card { padding: 1.5rem 1rem; }
            .q-text { font-size: 1.05rem; }
            .option-btn { padding: 0.75rem 0.85rem; font-size: 0.85rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Plan-B-Check</h1>
            <p>Wie resilient ist Ihre Energieversorgung?</p>
        </div>

        <div class="progress-wrap" id="progressWrap" style="display:none;">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div class="progress-label" id="progressLabel"></div>
        </div>

        <!-- INTRO -->
        <div class="question-card" id="intro">
            <div class="intro">
                <div class="intro-icon">üõ°Ô∏è</div>
                <h2>Energie braucht einen Plan B</h2>
                <p>8 Fragen. 3 Minuten. Sie erfahren, wie gut Sie auf einen Energieengpass vorbereitet sind ‚Äî und wo Ihre Schwachstellen liegen.</p>
                <div><button class="btn-start" onclick="startQuiz()">Jetzt pr√ºfen</button></div>
            </div>
        </div>

        <!-- QUESTIONS (rendered by JS) -->
        <div class="question-card" id="questionCard" style="display:none;"></div>

        <!-- RESULT -->
        <div class="result" id="resultScreen">
            <div class="score-ring">
                <svg viewBox="0 0 180 180">
                    <circle class="bg" cx="90" cy="90" r="80" />
                    <circle class="fg" id="scoreArc" cx="90" cy="90" r="80" />
                </svg>
                <div class="score-value">
                    <div class="num" id="scoreNum">0</div>
                    <div class="of">von 100</div>
                </div>
            </div>
            <div class="score-label" id="scoreLabel"></div>
            <div class="weakness-list" id="weaknesses">
                <h3>Ihre Schwachstellen</h3>
                <div id="weaknessItems"></div>
            </div>
            <div class="result-cta">
                <a href="index.html">Aktuelle Versorgungslage ansehen</a>
                <div class="sub">Gasspeicher, Preise & Prognosen auf energienotfall.de</div>
            </div>
            <button class="btn-restart" onclick="restart()">Erneut pr√ºfen</button>
        </div>

        <div class="back-link"><a href="index.html">‚Üê energienotfall.de</a></div>
    </div>

<script>
// ‚îÄ‚îÄ Question definitions with per-segment overrides ‚îÄ‚îÄ
const questions = [
    {
        id: 'segment',
        category: '',
        num: 1,
        text: 'Wof√ºr pr√ºfen Sie?',
        hint: 'Ihre Auswahl bestimmt den Kontext der folgenden Fragen.',
        options: [
            { icon: 'üè†', label: 'Eigenheim / Wohnung', desc: 'Private Heizung & Warmwasser', value: 'haus', points: 0 },
            { icon: 'üè¢', label: 'Gewerbebetrieb', desc: 'B√ºro, Laden, Gastst√§tte, Handwerk', value: 'betrieb', points: 0 },
            { icon: 'üè≠', label: 'Produktion / Industrie', desc: 'Prozessw√§rme, Fertigung, Logistik', value: 'produktion', points: 0 }
        ]
    },
    {
        id: 'hauptenergie',
        category: 'Brennstoff',
        ishikawa: 'brennstoff',
        num: 2,
        haus: {
            text: 'Was ist Ihr Hauptenergietr√§ger?',
            hint: 'Der Energietr√§ger, von dem Ihre Heizung am st√§rksten abh√§ngt.',
            options: [
                { icon: 'üî•', label: 'Erdgas', desc: 'Pipeline-Gas, netzgebunden', value: 'gas', points: 15 },
                { icon: '‚ö°', label: 'Strom (W√§rmepumpe)', desc: 'Netzgebunden, stromabh√§ngig', value: 'strom', points: 10 },
                { icon: 'üõ¢Ô∏è', label: 'Heiz√∂l', desc: 'Tank im Keller, lagerf√§hig', value: 'oel', points: 5 },
                { icon: 'ü™µ', label: 'Holz / Pellets', desc: 'Lagerf√§hig, regional verf√ºgbar', value: 'holz', points: 0 },
                { icon: 'üå°Ô∏è', label: 'Fernw√§rme', desc: 'Netzgebunden, kein eigener Speicher', value: 'fernwaerme', points: 12 }
            ]
        },
        betrieb: {
            text: 'Wovon h√§ngt Ihr Betrieb energetisch ab?',
            hint: 'Strom f√ºr IT, Kasse, K√ºhlung ‚Äî Gas f√ºr K√ºche, Heizung. Was darf nicht ausfallen?',
            options: [
                { icon: '‚ö°', label: 'Strom ist alles', desc: 'IT, Kasse, K√ºhlung, Licht ‚Äî ohne Strom steht der Laden', value: 'strom', points: 15 },
                { icon: 'üî•', label: 'Gas ist kritisch', desc: 'Gro√ük√ºche, Backofen, Prozessw√§rme', value: 'gas', points: 15 },
                { icon: '‚ö°üî•', label: 'Beides gleichwertig', desc: 'Strom UND Gas unverzichtbar', value: 'beides', points: 15 },
                { icon: 'üå°Ô∏è', label: 'Fernw√§rme / Nahw√§rme', desc: 'Heizung extern, Strom f√ºr den Rest', value: 'fernwaerme', points: 10 }
            ]
        },
        produktion: {
            text: 'Welcher Energietr√§ger treibt Ihre Produktion?',
            hint: 'Prozessw√§rme, Druckluft, Antriebe ‚Äî wo sitzt die gr√∂√üte Abh√§ngigkeit?',
            options: [
                { icon: 'üî•', label: 'Erdgas (Prozessw√§rme)', desc: 'Schmelzen, Trocknen, Dampf ‚Äî gasabh√§ngig', value: 'gas', points: 15 },
                { icon: '‚ö°', label: 'Strom (Antriebe, Druckluft)', desc: 'Motoren, Kompressoren, Steuerung', value: 'strom', points: 15 },
                { icon: '‚ô®Ô∏è', label: 'Dampf / Fernw√§rme', desc: 'Extern bezogen, kein eigener Kessel', value: 'fernwaerme', points: 12 },
                { icon: 'üîÑ', label: 'Mehrere gleichwertig', desc: 'Gas + Strom + ggf. Dampf im Mix', value: 'beides', points: 10 }
            ]
        }
    },
    {
        id: 'diversifikation',
        category: 'Brennstoff',
        ishikawa: 'brennstoff',
        num: 3,
        haus: {
            text: 'Haben Sie einen zweiten Energietr√§ger?',
            hint: 'Z.B. Kaminofen, Solarthermie, Infrarotheizung als Erg√§nzung.',
            options: [
                { icon: 'üö´', label: 'Nein, nur eine Quelle', desc: 'Kompletter Ausfall bei St√∂rung', value: 'nein', points: 15 },
                { icon: 'üîÑ', label: 'Ja, als Erg√§nzung', desc: 'Deckt Teilbedarf, z.B. Kaminofen', value: 'ergaenzung', points: 5 },
                { icon: '‚úÖ', label: 'Ja, voll umschaltbar', desc: 'Kann Hauptquelle komplett ersetzen', value: 'voll', points: 0 }
            ]
        },
        betrieb: {
            text: 'Gibt es eine Backup-Versorgung f√ºr den Betrieb?',
            hint: 'Notstrom f√ºr Kasse und K√ºhlung? Zweiter Energietr√§ger f√ºr Kernprozesse?',
            options: [
                { icon: 'üö´', label: 'Nein, kein Backup', desc: 'Ausfall = Betriebsstillstand', value: 'nein', points: 15 },
                { icon: 'üîã', label: 'Notstrom f√ºr das N√∂tigste', desc: 'USV f√ºr Kasse, Server oder K√ºhlung', value: 'ergaenzung', points: 7 },
                { icon: '‚úÖ', label: 'Ja, Vollbetrieb abgesichert', desc: 'Generator oder zweite Quelle f√ºr alle Kernprozesse', value: 'voll', points: 0 }
            ]
        },
        produktion: {
            text: 'Gibt es Dual-Fuel oder Ausweichkapazit√§t?',
            hint: 'K√∂nnen Sie bei Gasrationierung auf einen anderen Brennstoff umschalten?',
            options: [
                { icon: 'üö´', label: 'Nein ‚Äî Totalausfall bei Engpass', desc: 'Kein Ersatzbrennstoff, keine Ausweichproduktion', value: 'nein', points: 15 },
                { icon: 'üîÑ', label: 'Teilbetrieb m√∂glich', desc: 'Reduzierte Kapazit√§t, kritische Linien laufen', value: 'ergaenzung', points: 7 },
                { icon: '‚úÖ', label: 'Ja, Dual-Fuel oder Eigenerzeugung', desc: 'Umschaltbare Brenner, BHKW, PV + Speicher', value: 'voll', points: 0 }
            ]
        }
    },
    {
        id: 'stromausfall',
        category: 'Technik',
        ishikawa: 'technik',
        num: 4,
        haus: {
            text: 'Funktioniert Ihre Heizung ohne Strom?',
            hint: 'Gasheizung, W√§rmepumpe, Pelletkessel ‚Äî fast alle brauchen Strom f√ºr Pumpen und Steuerung.',
            options: [
                { icon: 'üîå', label: 'Nein, komplett stromabh√§ngig', desc: 'Heizung f√§llt bei Stromausfall sofort aus', value: 'sofort', points: 15 },
                { icon: 'üîã', label: 'Teilweise ‚Äî Batterie/USV vorhanden', desc: '√úberbr√ºckt einige Stunden', value: 'stunden', points: 7 },
                { icon: 'üèïÔ∏è', label: 'Ja, autark m√∂glich', desc: 'Kaminofen, Holzherd oder √§hnlich', value: 'autark', points: 0 }
            ]
        },
        betrieb: {
            text: 'Wie lange l√§uft Ihr Betrieb ohne Strom?',
            hint: 'Kasse, K√ºhlung, IT, Beleuchtung ‚Äî was geht sofort, was hat Puffer?',
            options: [
                { icon: 'üíÄ', label: 'Sofort Stillstand', desc: 'Kein Strom = kein Betrieb. Kasse tot, K√ºhlung aus, T√ºr zu.', value: 'sofort', points: 15 },
                { icon: 'üîã', label: 'Wenige Stunden (USV)', desc: 'Kasse und Server laufen, aber K√ºhlung und Licht fallen aus', value: 'stunden', points: 7 },
                { icon: '‚õΩ', label: 'Halber Tag oder mehr', desc: 'Notstromaggregat oder Batteriespeicher vorhanden', value: 'autark', points: 0 }
            ]
        },
        produktion: {
            text: 'Was passiert bei 4 Stunden Stromausfall?',
            hint: 'Erstarrte Schmelze, verlorene Chargen, besch√§digte Anlagen ‚Äî oder kontrolliertes Herunterfahren?',
            options: [
                { icon: 'üíÄ', label: 'Totalschaden m√∂glich', desc: 'Schmelze erstarrt, Charge verloren, Anlage besch√§digt', value: 'sofort', points: 15 },
                { icon: '‚è∏Ô∏è', label: 'Produktionsstopp, kein Schaden', desc: 'Maschinen stehen, aber kein irreversibler Schaden', value: 'stunden', points: 7 },
                { icon: '‚ö°', label: 'Notstrom sichert kritische Prozesse', desc: 'Generator/USV f√ºr Steuerung und Kernanlagen', value: 'autark', points: 0 }
            ]
        }
    },
    {
        id: 'vorrat',
        category: 'Prozess',
        ishikawa: 'prozess',
        num: 5,
        haus: {
            text: 'Wie lange reicht Ihr Energievorrat?',
            hint: 'Heiz√∂ltank, Holzlager, Pelletvorrat ‚Äî oder gar keiner bei Gas/Strom.',
            options: [
                { icon: '‚ö†Ô∏è', label: 'Kein Vorrat', desc: 'Netzgebunden ‚Äî Versorgung endet sofort bei Ausfall', value: 'kein', points: 15 },
                { icon: 'üì¶', label: 'Wenige Tage', desc: 'Kleiner Holzvorrat oder Tank fast leer', value: 'tage', points: 8 },
                { icon: 'üè†', label: 'Mehrere Wochen', desc: 'Heiz√∂ltank voll, Holzlager gef√ºllt, Pellets gebunkert', value: 'wochen', points: 0 }
            ]
        },
        betrieb: {
            text: 'Wie lange h√§lt Ihre √úberbr√ºckung?',
            hint: 'USV-Akku, Diesel-Vorrat f√ºrs Aggregat, Puffer f√ºr K√ºhlung.',
            options: [
                { icon: '‚ö†Ô∏è', label: 'Keine √úberbr√ºckung', desc: 'Ausfall = sofort Umsatzverlust', value: 'kein', points: 15 },
                { icon: 'üîã', label: 'Wenige Stunden', desc: 'USV oder kleine Batterie √ºberbr√ºckt das N√∂tigste', value: 'tage', points: 8 },
                { icon: '‚õΩ', label: '1 Tag oder mehr', desc: 'Diesel-Generator mit Tankvorrat, Batterie-Speicher', value: 'wochen', points: 0 }
            ]
        },
        produktion: {
            text: 'Haben Sie Energiereserven f√ºr den Ernstfall?',
            hint: 'Brennstofftanks, Eigenerzeuger, Dampfspeicher, Druckluftspeicher.',
            options: [
                { icon: '‚ö†Ô∏è', label: 'Keine Reserven', desc: 'Just-in-Time ‚Äî kein Puffer bei Lieferausfall', value: 'kein', points: 15 },
                { icon: 'üì¶', label: 'Notfall-√úberbr√ºckung', desc: 'Generator, kleiner Tank ‚Äî Stunden bis 1 Tag', value: 'tage', points: 8 },
                { icon: 'üè≠', label: 'Eigenerzeugung vorhanden', desc: 'BHKW, √ñltank, PV + Speicher ‚Äî Tage autark', value: 'wochen', points: 0 }
            ]
        }
    },
    {
        id: 'wartung',
        category: 'Management',
        ishikawa: 'management',
        num: 6,
        haus: {
            text: 'Wann wurde Ihre Heizung zuletzt gewartet?',
            hint: 'Regelm√§√üige Wartung verhindert Ausf√§lle in der Heizsaison.',
            options: [
                { icon: 'üï∏Ô∏è', label: '√úber 2 Jahre her', desc: 'Erh√∂htes Ausfallrisiko mitten im Winter', value: 'alt', points: 10 },
                { icon: 'üîß', label: 'Innerhalb der letzten 12 Monate', desc: 'Im Rahmen der Empfehlung', value: 'ok', points: 3 },
                { icon: '‚úÖ', label: 'Aktuell gewartet + Wartungsvertrag', desc: 'Notdienst-Garantie inklusive', value: 'aktuell', points: 0 }
            ]
        },
        betrieb: {
            text: 'Wie ist der Wartungsstand Ihrer kritischen Systeme?',
            hint: 'Heizung, K√ºhlung, USV, Kassensystem, Brandschutz ‚Äî alles aktuell?',
            options: [
                { icon: 'üï∏Ô∏è', label: '√úberf√§llig oder unklar', desc: 'Kein √úberblick, letzter Service lange her', value: 'alt', points: 10 },
                { icon: 'üîß', label: 'Regelm√§√üig, aber ohne Vertrag', desc: 'Wird gemacht, aber kein Notdienst garantiert', value: 'ok', points: 3 },
                { icon: '‚úÖ', label: 'Wartungsvertr√§ge f√ºr alle Kernsysteme', desc: 'SLA mit Reaktionszeit, Notdienst 24/7', value: 'aktuell', points: 0 }
            ]
        },
        produktion: {
            text: 'Wie ist der Wartungsstand Ihrer Energieanlagen?',
            hint: 'Kessel, Brenner, Kompressoren, Notstrom, Steuerungstechnik.',
            options: [
                { icon: 'üï∏Ô∏è', label: 'Reaktiv ‚Äî erst bei Ausfall', desc: 'Keine pr√§ventive Wartung, hohes Ausfallrisiko', value: 'alt', points: 10 },
                { icon: 'üîß', label: 'Planm√§√üig nach Intervall', desc: 'Wartungsplan vorhanden, wird eingehalten', value: 'ok', points: 3 },
                { icon: '‚úÖ', label: 'Predictive + Redundanz', desc: 'Zustands√ºberwachung, Ersatzteillager, Backup-Systeme', value: 'aktuell', points: 0 }
            ]
        }
    },
    {
        id: 'notfallplan',
        category: 'Mensch',
        ishikawa: 'mensch',
        num: 7,
        haus: {
            text: 'Wissen Sie, was bei Heizungsausfall zu tun ist?',
            hint: 'Winter, Heizung f√§llt aus ‚Äî kennen alle Bewohner die n√§chsten Schritte?',
            options: [
                { icon: 'ü§∑', label: 'Nein, kein Plan', desc: 'Improvisieren und hoffen', value: 'nein', points: 10 },
                { icon: 'üìù', label: 'Grob im Kopf', desc: 'Ungef√§hre Vorstellung, nichts dokumentiert', value: 'ansatz', points: 5 },
                { icon: 'üìã', label: 'Ja, alle wissen Bescheid', desc: 'Notfall-Nummern, Ersatzheizung, Ma√ünahmen klar', value: 'ja', points: 0 }
            ]
        },
        betrieb: {
            text: 'Gibt es einen Notfallplan f√ºr Betriebsunterbrechung?',
            hint: 'Wer entscheidet? Wer wird informiert? Wie geht es weiter, wenn Strom oder Gas ausf√§llt?',
            options: [
                { icon: 'ü§∑', label: 'Nein ‚Äî wir improvisieren', desc: 'Kein Plan, keine Zust√§ndigkeiten definiert', value: 'nein', points: 10 },
                { icon: 'üìù', label: 'Ansatzweise vorhanden', desc: 'Chef wei√ü Bescheid, aber nichts dokumentiert', value: 'ansatz', points: 5 },
                { icon: 'üìã', label: 'Ja, dokumentiert mit Checkliste', desc: 'Verantwortliche benannt, Ablauf getestet, Nummern griffbereit', value: 'ja', points: 0 }
            ]
        },
        produktion: {
            text: 'Gibt es einen Business Continuity Plan?',
            hint: 'Dokumentierter Notfallplan mit Eskalationsstufen, Verantwortlichen und Wiederanlaufprozedur?',
            options: [
                { icon: 'ü§∑', label: 'Nein, kein BCP', desc: 'Kein dokumentierter Plan f√ºr Energieausfall', value: 'nein', points: 10 },
                { icon: 'üìù', label: 'Teilweise ‚Äî nicht getestet', desc: 'Plan existiert auf Papier, aber nie ge√ºbt', value: 'ansatz', points: 5 },
                { icon: 'üìã', label: 'Ja, getestet und aktuell', desc: 'BCP mit Eskalation, √úbungen, Wiederanlauf dokumentiert', value: 'ja', points: 0 }
            ]
        }
    },
    {
        id: 'vertrag',
        category: 'Umfeld',
        ishikawa: 'umfeld',
        num: 8,
        haus: {
            text: 'Wie flexibel ist Ihr Energievertrag?',
            hint: 'Langfristbindung = g√ºnstig, aber kein schneller Wechsel bei Preissprung.',
            options: [
                { icon: 'üîí', label: 'Ein Anbieter, Langzeitvertrag', desc: 'Gebunden, kein schneller Wechsel m√∂glich', value: 'gebunden', points: 10 },
                { icon: 'üîì', label: 'Mittelfristig, wechselbar', desc: 'Vertrag mit angemessener K√ºndigungsfrist', value: 'mittel', points: 4 },
                { icon: 'üÜì', label: 'Flexibel, mehrere Optionen', desc: 'Kurze Bindung oder mehrere Energiequellen', value: 'flexibel', points: 0 }
            ]
        },
        betrieb: {
            text: 'Wie abgesichert sind Sie vertraglich?',
            hint: 'Energievertrag, Versicherung gegen Betriebsunterbrechung, Lieferantenvertr√§ge.',
            options: [
                { icon: 'üîí', label: 'Ein Versorger, keine BU-Versicherung', desc: 'Gebunden + unversichert bei Ausfall', value: 'gebunden', points: 10 },
                { icon: 'üîì', label: 'Wechselbar, Basis-Versicherung', desc: 'Vertrag flexibel, Grundschutz vorhanden', value: 'mittel', points: 4 },
                { icon: 'üÜì', label: 'Diversifiziert + BU-versichert', desc: 'Mehrere Lieferanten, Betriebsunterbrechung abgedeckt', value: 'flexibel', points: 0 }
            ]
        },
        produktion: {
            text: 'Wie sind Energievertr√§ge und Lieferketten abgesichert?',
            hint: 'Energiebezug, Zulieferer-Abh√§ngigkeiten, Versicherungsschutz f√ºr Produktionsausfall.',
            options: [
                { icon: 'üîí', label: 'Single Source, keine Ausfallversicherung', desc: 'Ein Versorger, ein Zulieferer ‚Äî kein Netz', value: 'gebunden', points: 10 },
                { icon: 'üîì', label: 'Teilweise diversifiziert', desc: 'Zweitlieferant m√∂glich, Basisversicherung', value: 'mittel', points: 4 },
                { icon: 'üÜì', label: 'Voll diversifiziert + versichert', desc: 'Multi-Sourcing, Ausfallversicherung, Rahmenvertr√§ge', value: 'flexibel', points: 0 }
            ]
        }
    }
];

// Max possible risk points (worst answers across all questions excl. segment)
const MAX_POINTS = 15 + 15 + 15 + 15 + 10 + 10 + 10; // 90

let currentStep = -1;
let answers = {};    // { questionId: optionIndex }
let answerValues = {}; // { questionId: optionValue } ‚Äî for recommendations
let segment = 'haus';

function getQ(q) {
    // Return segment-specific version merged with base
    const s = q[segment] || q['haus'] || {};
    return {
        id: q.id,
        category: q.category || '',
        ishikawa: q.ishikawa || '',
        num: q.num,
        text: s.text || q.text,
        hint: s.hint || q.hint,
        options: s.options || q.options
    };
}

function startQuiz() {
    document.getElementById('intro').style.display = 'none';
    document.getElementById('progressWrap').style.display = 'block';
    currentStep = 0;
    renderQuestion();
}

function renderQuestion() {
    const card = document.getElementById('questionCard');
    const q = getQ(questions[currentStep]);

    card.classList.add('slide-out');

    setTimeout(() => {
        card.style.display = 'flex';

        let html = '';
        if (q.category) html += `<div class="q-category">${q.category}</div>`;
        html += `<div class="q-number">Frage ${q.num} von ${questions.length}</div>`;
        html += `<div class="q-text">${q.text}</div>`;
        html += `<div class="q-hint">${q.hint}</div>`;
        html += `<div class="options">`;

        q.options.forEach((opt, i) => {
            const selected = answers[q.id] === i ? ' selected' : '';
            html += `
                <div class="option-btn${selected}" onclick="selectOption(${i})">
                    <div class="option-icon">${opt.icon}</div>
                    <div>
                        <div class="option-label">${opt.label}</div>
                        <div class="option-desc">${opt.desc}</div>
                    </div>
                </div>`;
        });
        html += `</div>`;

        html += `<div class="nav-row">`;
        html += `<button class="btn-back" ${currentStep === 0 ? 'disabled' : ''} onclick="goBack()">‚Üê Zur√ºck</button>`;
        html += `<div></div>`;
        html += `</div>`;

        card.innerHTML = html;

        const pct = ((currentStep + 1) / questions.length) * 100;
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressLabel').textContent = `${currentStep + 1} / ${questions.length}`;

        card.classList.remove('slide-out');
        card.classList.add('slide-in');
        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                card.classList.remove('slide-in');
            });
        });
    }, 200);
}

function selectOption(index) {
    const raw = questions[currentStep];
    const q = getQ(raw);
    answers[q.id] = index;
    answerValues[q.id] = q.options[index].value;

    if (q.id === 'segment') {
        segment = q.options[index].value;
        // Clear subsequent answers ‚Äî segment changed, questions differ
        questions.forEach((qq, i) => {
            if (i > currentStep) { delete answers[qq.id]; delete answerValues[qq.id]; }
        });
    }

    const btns = document.querySelectorAll('.option-btn');
    btns.forEach((b, i) => b.classList.toggle('selected', i === index));

    setTimeout(() => {
        if (currentStep < questions.length - 1) {
            currentStep++;
            renderQuestion();
        } else {
            showResult();
        }
    }, 300);
}

function goBack() {
    if (currentStep > 0) {
        currentStep--;
        renderQuestion();
    }
}

function showResult() {
    document.getElementById('questionCard').style.display = 'none';
    document.getElementById('progressWrap').style.display = 'none';

    let riskPoints = 0;
    let weaknesses = [];

    questions.forEach(raw => {
        if (raw.id === 'segment') return;
        const q = getQ(raw);
        const idx = answers[q.id];
        if (idx !== undefined) {
            const opt = q.options[idx];
            riskPoints += opt.points;
            if (opt.points >= 10) {
                weaknesses.push({
                    category: q.category,
                    ishikawa: q.ishikawa,
                    recommendation: getRecommendation(q.id, opt.value)
                });
            }
        }
    });

    const multiplier = segment === 'produktion' ? 1.2 : segment === 'betrieb' ? 1.1 : 1.0;
    const adjustedRisk = Math.min(riskPoints * multiplier, MAX_POINTS);
    const score = Math.round(100 - (adjustedRisk / MAX_POINTS) * 100);

    const resultScreen = document.getElementById('resultScreen');
    resultScreen.classList.add('active');

    const arc = document.getElementById('scoreArc');
    const circumference = 2 * Math.PI * 80;
    const offset = circumference - (score / 100) * circumference;

    let color;
    if (score >= 70) color = '#27ae60';
    else if (score >= 40) color = '#f39c12';
    else color = '#e74c3c';

    setTimeout(() => {
        arc.style.stroke = color;
        arc.style.strokeDashoffset = offset;
    }, 100);

    animateNumber('scoreNum', 0, score, 1200);

    const label = document.getElementById('scoreLabel');
    if (score >= 80) {
        label.textContent = 'üõ°Ô∏è Gut aufgestellt ‚Äî geringe Verwundbarkeit';
        label.style.background = 'rgba(39, 174, 96, 0.15)';
        label.style.color = '#27ae60';
    } else if (score >= 60) {
        label.textContent = '‚ö° Teilweise resilient ‚Äî Optimierungspotential';
        label.style.background = 'rgba(243, 156, 18, 0.15)';
        label.style.color = '#f39c12';
    } else if (score >= 40) {
        label.textContent = '‚ö†Ô∏è Verwundbar ‚Äî handeln Sie jetzt';
        label.style.background = 'rgba(243, 156, 18, 0.2)';
        label.style.color = '#e67e22';
    } else {
        label.textContent = 'üö® Hochriskant ‚Äî kein Plan B vorhanden';
        label.style.background = 'rgba(231, 76, 60, 0.15)';
        label.style.color = '#e74c3c';
    }

    const container = document.getElementById('weaknessItems');
    if (weaknesses.length === 0) {
        container.innerHTML = '<div style="color:#27ae60; padding:0.5rem 0; font-size:0.9rem;">Keine kritischen Schwachstellen identifiziert.</div>';
    } else {
        container.innerHTML = weaknesses.map(w => `
            <div class="weakness-item">
                <div class="wi-icon">‚ö†Ô∏è</div>
                <div>
                    <div>${w.recommendation}</div>
                    <div class="wi-cat">${w.category}</div>
                </div>
            </div>
        `).join('');
    }
}

// ‚îÄ‚îÄ Segment-adaptive recommendations ‚îÄ‚îÄ
function getRecommendation(qId, value) {
    const r = {
        haus: {
            hauptenergie: {
                gas: 'Erdgas ist netzgebunden und importabh√§ngig. Ein Kaminofen oder Pelletofen als Backup reduziert Ihr Risiko erheblich.',
                strom: 'Ihre W√§rmepumpe braucht Strom. Bei Netzausfall: keine Heizung. Pr√ºfen Sie Notstrom oder einen wasserf√ºhrenden Kaminofen.',
                fernwaerme: 'Fernw√§rme gibt Ihnen keine Kontrolle √ºber die Quelle. Ein unabh√§ngiger Zweitheizer schafft Sicherheit.',
                oel: 'Heiz√∂l ist lagerf√§hig ‚Äî aber importabh√§ngig und preisvolatil. Tank regelm√§√üig f√ºllen und Zweitheizer pr√ºfen.'
            },
            diversifikation: { nein: 'Nur eine Energiequelle = maximales Klumpenrisiko. Schon ein Kaminofen als Zweitheizer senkt die Verwundbarkeit deutlich.' },
            stromausfall: { sofort: 'Ihre Heizung f√§llt bei Stromausfall sofort aus. Eine USV oder ein netzunabh√§ngiger Ofen schafft √úberbr√ºckung.' },
            vorrat: { kein: 'Ohne Energievorrat sind Sie sofort betroffen. Pr√ºfen Sie, ob ein Brennstofflager (Holz, Pellets, Heiz√∂l) m√∂glich ist.' },
            wartung: { alt: '√úberf√§llige Wartung erh√∂ht das Ausfallrisiko im Winter. Ein Wartungsvertrag mit Notdienst-Garantie gibt Sicherheit.' },
            notfallplan: { nein: 'Kein Plan bedeutet Chaos im Ernstfall. Halten Sie fest: Wer tut was, wenn die Heizung im Winter ausf√§llt?' },
            vertrag: { gebunden: 'Langfristbindung an einen Anbieter macht Sie unflexibel. Pr√ºfen Sie Wechseloptionen oder eine zweite Energiequelle.' }
        },
        betrieb: {
            hauptenergie: {
                strom: 'Ihr Betrieb h√§ngt komplett am Stromnetz ‚Äî Kasse, K√ºhlung, IT. Ein Notstromaggregat sichert den Grundbetrieb bei Ausfall.',
                gas: 'Gasausfall = K√ºche kalt, Heizung aus. Pr√ºfen Sie Elektro-Backup f√ºr kritische Prozesse (Induktion, Infrarot).',
                beides: 'Doppelte Abh√§ngigkeit von Strom UND Gas. Priorisieren Sie: Was muss zuerst laufen? Sichern Sie diesen Prozess ab.',
                fernwaerme: 'Fernw√§rme f√§llt selten aus, aber Sie haben null Kontrolle. F√ºr Strom-Ausf√§lle: USV oder Generator pr√ºfen.'
            },
            diversifikation: { nein: 'Kein Backup = sofort Umsatzverlust bei Ausfall. Ein mobiles Notstromaggregat kann den Unterschied machen.' },
            stromausfall: { sofort: 'Strom weg = Laden dicht. Pr√ºfen Sie eine USV f√ºr Kasse und K√ºhlung, ggf. einen Dieselgenerator f√ºr l√§ngere Ausf√§lle.' },
            vorrat: { kein: 'Keine √úberbr√ºckung bedeutet: jede Minute Ausfall kostet Umsatz. Schon eine USV f√ºr 2‚Äì4 Stunden sch√ºtzt das Kerngesch√§ft.' },
            wartung: { alt: 'Ungewartete Systeme fallen im schlechtesten Moment aus. Wartungsvertr√§ge mit SLA und Notdienst sind Pflicht f√ºr den Betrieb.' },
            notfallplan: { nein: 'Ohne Notfallplan entscheidet niemand ‚Äî oder alle gleichzeitig. Definieren Sie: Wer ruft wen an? Was wird zuerst gesichert?' },
            vertrag: { gebunden: 'Ein Versorger, keine Betriebsunterbrechungsversicherung ‚Äî maximales Risiko. BU-Versicherung und Zweitversorger pr√ºfen.' }
        },
        produktion: {
            hauptenergie: {
                gas: 'Prozessw√§rme aus Gas ‚Äî bei Rationierung wird Industrie zuerst abgeschaltet. Dual-Fuel-Brenner oder Alternativquelle pr√ºfen.',
                strom: 'Stromabh√§ngige Produktion ‚Äî bei Netzinstabilit√§t droht Totalausfall. Eigenerzeugung (BHKW, PV + Speicher) schafft Unabh√§ngigkeit.',
                beides: 'Mehrfach-Abh√§ngigkeit mindert das Risiko ‚Äî aber nur wenn Ausf√§lle unkorreliert sind. Pr√ºfen Sie gemeinsame Schwachstellen.',
                fernwaerme: 'Extern bezogener Dampf/W√§rme: Pr√ºfen Sie Vertragsgarantien und Backup-Kessel f√ºr Engpasssituationen.'
            },
            diversifikation: { nein: 'Kein Ausweich-Brennstoff = Produktionsstopp bei Rationierung. Dual-Fuel-Nachr√ºstung oder mobile Kessel als Reserve pr√ºfen.' },
            stromausfall: { sofort: 'Totalschaden bei Stromausfall ‚Äî das ist inakzeptables Risiko. USV f√ºr Steuerung + Generator f√ºr Kernanlagen sind zwingend.' },
            vorrat: { kein: 'Just-in-Time ohne Puffer = maximale Verwundbarkeit. Eigenerzeugung (BHKW) oder Brennstoffreserve reduziert das Risiko.' },
            wartung: { alt: 'Reaktive Wartung bei Produktionsanlagen ist russisches Roulette. Predictive Maintenance und Ersatzteillager einf√ºhren.' },
            notfallplan: { nein: 'Ohne BCP droht bei Energieausfall Chaos mit Folgesch√§den. Eskalationsstufen, Verantwortliche und Wiederanlauf definieren.' },
            vertrag: { gebunden: 'Single-Source ohne Ausfallversicherung gef√§hrdet die Existenz. Multi-Sourcing, Rahmenvertr√§ge und Produktionsausfallversicherung pr√ºfen.' }
        }
    };
    const seg = r[segment] || r['haus'];
    const qRecs = seg[qId] || {};
    return qRecs[value] || 'Hier besteht Optimierungspotential ‚Äî pr√ºfen Sie Alternativen.';
}

function animateNumber(elementId, start, end, duration) {
    const el = document.getElementById(elementId);
    const startTime = performance.now();
    function update(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        el.textContent = Math.round(start + (end - start) * eased);
        if (progress < 1) requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
}

function restart() {
    answers = {};
    answerValues = {};
    segment = 'haus';
    currentStep = -1;
    document.getElementById('resultScreen').classList.remove('active');
    document.getElementById('scoreArc').style.strokeDashoffset = 502;
    document.getElementById('intro').style.display = 'flex';
    document.getElementById('progressWrap').style.display = 'none';
}
</script>
</body>
</html>
